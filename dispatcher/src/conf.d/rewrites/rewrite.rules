#
# This file contains the rewrite rules, and can be customized.
#
# By default, it includes just the rewrite rules. You can
# add rewrite rules to this file but you should still include
# the default rewrite rules.

Include conf.d/rewrites/default_rewrite.rules

# make sure the root site redirects are cache on CDN to avoid origin round-trip
Header always set Cache-Control "max-age=300,stale-while-revalidate=43200,stale-if-error=43200" env=cdncache

# OOTB -- redirect traffic from www to http home page
#RewriteCond %{HTTP_HOST} www.wknd.site [NC]
#RewriteRule ^(.*)$ https://wknd.site%{REQUEST_URI} [R=301,L,E=cdncache]

# rewrite for root redirect
RewriteCond %{REQUEST_URI} !(.pdf|.tiff|.jpe?g|.png|.svg|.mp4|.xlsx|.csv|.coreimg)$
##RewriteRule ^/?$ /content/${CONTENT_FOLDER_NAME}/us/en.html [PT,L]
RewriteRule ^/?$ /content/${CONTENT_FOLDER_NAME}/language-masters/en.html [PT,L]

### OOTB -- redirect all root traffic to US home page
#RewriteCond %{REQUEST_URI} ^/?$
#RewriteRule ^(/)$ /us/en.html [R=301,L,E=cdncache]

# remove any trailing slash, if it's there.
RewriteRule ^(.+)/$ $1

#Remove the html extension
RewriteCond %{REQUEST_URI} .*\.html$
##TEMP TESTING IF WKND LOGO WILL RETURN
RewriteCond %{REQUEST_URI} !^/content/experience-fragments
#RewriteCond %{REQUEST_URI} !^/content/experience-fragments/wknd/(.*)
#RewriteCond %{REQUEST_URI} !/_jcr_content/
RewriteRule ^(.*).html$ https://%{SERVER_NAME}$1 [R=301,L,QSA]

#Handle the landing page -- is this duplicated by above??
RewriteRule ^/$ /en/ [R=301,L]
#Mask the /content/geometrixx-outdoors path
##RewriteRule ^/content/wknd/(.*)(\.html)?$ $1 [NE,L,R=301]
RewriteRule ^/content/wknd/language-masters/(.*)(\.html)?$ $1 [NE,L,R=301]

#Append the .html for those URL's ending with / before sending to publisher
## UPDATE NOTE -- This rule is never satisfied MARK FOR REMOVAL
#RewriteCond %{REQUEST_URI} !^/$
#RewriteRule ^/(.*)/$ /$1.html [PT,L,QSA]

#Rewrite rules to cover languages homepage shortening
RewriteCond %{REQUEST_URI} !(.pdf|.tiff|.jpe?g|.png|.svg|.mp4|.xlsx|.csv|.coreimg)$
RewriteCond %{REQUEST_URI} !.*/image.coreimg.*
##RewriteRule ^/content/wknd/us/en/(.*)$ https://%{SERVER_NAME}/en/$1 [R,L]
##RewriteRule ^/en$ /content/wknd/us/en.html [PT,L,NC]
### Multi-lingual rule
RewriteRule ^/content/wknd/language-masters/(.*)$ https://%{SERVER_NAME}/$1 [R,L]
RewriteRule ^/(.*)$ /content/wknd/language-masters/$1.html [PT,L,NC]
#RewriteRule ^/content/wknd/language-masters/en/(.*)$ https://%{SERVER_NAME}/en/$1 [R,L]
#RewriteRule ^/en$ /content/wknd/language-masters/en.html [PT,L,NC]
#RewriteRule ^/content/wknd/language-masters/es/(.*)$ https://%{SERVER_NAME}/es/$1 [R,L]
#RewriteRule ^/es$ /content/wknd/language-masters/es.html [PT,L,NC]
#RewriteRule ^/content/wknd/us/vi/(.*)$ https://%{SERVER_NAME}/vi/$1 [R,L]
#RewriteRule ^/vi$ /content/wknd/us/vi.html [PT,L,NC]
#RewriteRule ^/content/wknd/us/zh/(.*)$ https://%{SERVER_NAME}/zh/$1 [R,L]
#RewriteRule ^/zh$ /content/wknd/us/zh.html [PT,L,NC]
# Bonus language testing
#RewriteRule ^/content/wknd/language-masters/fr/(.*)$ https://%{SERVER_NAME}/fr/$1 [R,L]
#RewriteRule ^/fr$ /content/wknd/language-masters/fr.html [PT,L,NC]

RewriteCond %{REQUEST_URI} !(.html|.jpe?g|.png|.svg|.mp4|.pdf|.tiff|.xlsx|.csv|.coreimg)$
RewriteCond %{REQUEST_URI} !.*/image.coreimg.*
### Multi-lingual rule
RewriteRule ^/content/wknd/language-masters/(.*)$ /$1 [R,L]
#RewriteRule ^/content/wknd/language-masters/en/(.*)$ /$1 [R,L]
#RewriteRule ^/content/wknd/language-masters/es/(.*)$ /$1 [L,R=301]
##RewriteRule ^/content/wknd/us/vi/(.*)$ /vi/$1 [L,R=301]
##RewriteRule ^/content/wknd/us/zh/(.*)$ /zh/$1 [L,R=301]
## Bonus language testing
#RewriteRule ^/content/wknd/language-masters/fr/(.*)$ /$1 [L,R=301]

RewriteCond %{REQUEST_URI} !(.html|.jpe?g|.png|.svg|.mp4|.pdf|.tiff|.xlsx|.csv|.json|.coreimg)$
RewriteCond %{REQUEST_URI} !.*/image.coreimg.*
### Multi-lingual rule
RewriteRule ^/(.*)$ /content/wknd/language-masters/$1.html [PT,L,NC]
#RewriteRule ^/en/(.*)$ /content/wknd/language-masters/en/$1.html [PT,L,NC]
#RewriteRule ^/es/(.*)$ /content/wknd/language-masters/es/$1.html [PT,L,NC]
##RewriteRule ^/vi/(.*)$ /content/wknd/us/vi/$1.html [PT,L,NC]
##RewriteRule ^/zh/(.*)$ /content/wknd/us/zh/$1.html [PT,L,NC]
# Bonus language testing
#RewriteRule ^/fr/(.*)$ /content/wknd/language-masters/fr/$1.html [PT,L,NC]

RewriteCond %{REQUEST_URI} (.pdf|.tiff|.jpe?g|.png|.svg|.mp4|.xlsx|.csv|.coreimg)$
RewriteCond %{REQUEST_URI} !.*/image.coreimg.*
RewriteRule ^/dam/(.*)$ /content/dam/wknd/$1 [PT,L]

RewriteCond %{REQUEST_URI} !^/apps
RewriteCond %{REQUEST_URI} !^/bin
RewriteCond %{REQUEST_URI} !^/content
RewriteCond %{REQUEST_URI} !^/etc
RewriteCond %{REQUEST_URI} !^/home
RewriteCond %{REQUEST_URI} !^/libs
RewriteCond %{REQUEST_URI} !^/saml_login
RewriteCond %{REQUEST_URI} !^/system
RewriteCond %{REQUEST_URI} !^/tmp
RewriteCond %{REQUEST_URI} !^/var
RewriteCond %{REQUEST_URI} (.html|.jpe?g|.png|.svg|.coreimg)$
RewriteCond %{REQUEST_URI} .*/image.coreimg.*
RewriteRule ^/(.*)$ /content/${CONTENT_FOLDER_NAME}/$1 [PT,L]
