#
# This file contains the rewrite rules, and can be customized.
#
# By default, it includes just the rewrite rules. You can
# add rewrite rules to this file but you should still include
# the default rewrite rules.

Include conf.d/rewrites/default_rewrite.rules

# make sure the root site redirects are cache on CDN to avoid origin round-trip
Header always set Cache-Control "max-age=3,stale-while-revalidate=43200,stale-if-error=43200" env=cdncache

#Rewrite rule to redirect the full path to short path for all the pages under en
RewriteCond %{REQUEST_URI} (.html)$
RewriteCond %{REQUEST_URI} !(.jpe?g|.png|.svg|gif)$
RewriteCond %{REQUEST_URI} !^/content/dam
RewriteRule ^/content/wknd/language-masters/en/(.+).html https://%{SERVER_NAME}/$1 [R=301,L,NC,NE]

RewriteRule ^/content/wknd/language-masters/en.html https://%{SERVER_NAME} [R=301,L,NC,NE]

# rewrite for root redirect
RewriteRule ^/?$ /content/wknd/language-masters/en.html [PT,L]

RewriteCond %{REQUEST_URI} !^/apps
RewriteCond %{REQUEST_URI} !^/bin
RewriteCond %{REQUEST_URI} !^/content
RewriteCond %{REQUEST_URI} !^/content/experience-fragments
RewriteCond %{REQUEST_URI} !^/etc
RewriteCond %{REQUEST_URI} !^/home
RewriteCond %{REQUEST_URI} !^/libs
RewriteCond %{REQUEST_URI} !^/saml_login
RewriteCond %{REQUEST_URI} !^/system
RewriteCond %{REQUEST_URI} !^/tmp
RewriteCond %{REQUEST_URI} !^/var
RewriteCond %{REQUEST_URI} !(.*coreimg.*)
RewriteCond %{REQUEST_URI} (.html|.jpe?g|.png|.svg)$
RewriteRule ^/(.*)$ /content/${CONTENT_FOLDER_NAME}/language-masters/en/$1 [PT,L]

#Only for coreimg files under page root
RewriteCond %{REQUEST_URI} (.*coreimg.*)
RewriteRule ^/(.*)$ /content/${CONTENT_FOLDER_NAME}/language-masters/en/$1 [PT,L]

## Add .html extension where there is no extension
RewriteCond %{REQUEST_METHOD} !^POST
RewriteCond %{REQUEST_URI} !/$
RewriteCond %{REQUEST_URI} !(.html|.jpe?g|.png|.svg)$
RewriteRule ^/(.*)$ /content/wknd/language-masters/en/$1.html [PT,L]
